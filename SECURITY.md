# üõ°Ô∏è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –∑ –±–µ–∑–ø–µ–∫–∏ –¥–æ–¥–∞—Ç–∫—É

## –û–≥–ª—è–¥

–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É (Sanity CMS) –∑–∞–º—ñ—Å—Ç—å –≤–ª–∞—Å–Ω–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –¥–æ–¥–∞—Ç–æ–∫ –º–∞—î –∫—ñ–ª—å–∫–∞ —Ä—ñ–≤–Ω—ñ–≤ –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –º–æ–∂–ª–∏–≤–∏—Ö –∞—Ç–∞–∫.

---

## 10 –†—ñ–≤–Ω—ñ–≤ –ó–∞—Ö–∏—Å—Ç—É

### 1Ô∏è‚É£ Rate Limiting (–û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤)

**–©–æ –∑–∞—Ö–∏—â–∞—î:** DDoS –∞—Ç–∞–∫–∏, —Å–ø–∞–º, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ –∞—Ç–∞–∫–∏

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –ú–∞–∫—Å–∏–º—É–º 5 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑–∞ 1 —Ö–≤–∏–ª–∏–Ω—É –∑ –æ–¥–Ω–æ–≥–æ IP
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Map –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∏–¥–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —Ç–∞–π–º–∞—É—Ç—É

**–ö–æ–¥:**

```typescript
const rateLimitMap = new Map<string, { count: number; resetTime: number }>();

function checkRateLimit(ip: string): boolean {
  const now = Date.now();
  const limit = rateLimitMap.get(ip);

  if (!limit || now > limit.resetTime) {
    rateLimitMap.set(ip, { count: 1, resetTime: now + 60000 });
    return true;
  }

  if (limit.count >= 5) {
    return false; // –ë–ª–æ–∫—É—î–º–æ
  }

  limit.count++;
  return true;
}
```

---

### 2Ô∏è‚É£ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (Zod Schema)

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ, –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä—ñ–≤, –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ —Ç–∏–ø–∏

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Zod –¥–ª—è —Å—Ç—Ä–æ–≥–æ—ó —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É UUID, –¥–∞—Ç, —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤, —ñ–º–µ–Ω
- –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏ —Ä—è–¥–∫—ñ–≤ —Ç–∞ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤ —á–∏—Å–µ–ª

**–ü—Ä–∏–∫–ª–∞–¥:**

```typescript
const bookingSchema = z.object({
  roomId: z.string().uuid(),
  payload: z.object({
    user_name: z
      .string()
      .min(2)
      .max(100)
      .regex(/^[\p{L}\s'-]+$/u),
    user_phone: z.string().regex(/^\+?[0-9\s\-]{7,15}$/),
    rent_price: z.number().positive().max(1000000),
    people_count: z.number().int().min(1).max(10),
  }),
});
```

---

### 3Ô∏è‚É£ XSS –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è (Cross-Site Scripting)

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ JavaScript –∫–æ–¥—É

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –ï–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö HTML —Å–∏–º–≤–æ–ª—ñ–≤: `< > " ' &`
- –ó–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –≤—Å—ñ—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –û—á–∏—â–µ–Ω–Ω—è –ø—Ä–æ–±—ñ–ª—ñ–≤ (trim)

**–ö–æ–¥:**

```typescript
function sanitizeString(str: string): string {
  return str
    .replace(/[<>"'&]/g, (char) => {
      const entities: Record<string, string> = {
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#x27;",
        "&": "&amp;",
      };
      return entities[char] || char;
    })
    .trim();
}
```

---

### 4Ô∏è‚É£ IP Tracking

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞ –∑–∞–ø–∏—Ç—ñ–≤

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è IP –∑ header `x-forwarded-for`
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è rate limiting
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—ñ–¥–æ–∑—Ä—ñ–ª–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

---

### 5Ô∏è‚É£ Schema Validation –Ω–∞ —Ä—ñ–≤–Ω—ñ API

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏, –æ–±—Ö—ñ–¥ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –ü–æ–¥–≤—ñ–π–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è: –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ (—Ñ–æ—Ä–º–∞) —ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ (API)
- –°–µ—Ä–≤–µ—Ä **–Ω–µ –¥–æ–≤—ñ—Ä—è—î** –∫–ª—ñ—î–Ω—Ç—É
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å–æ–º –≤ –ë–î

---

### 6Ô∏è‚É£ –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞—Ç

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è, –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –∑ –¥–∞—Ç–∞–º–∏

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∏:**

- ‚úÖ –î–∞—Ç–∞ –≤–∏—ó–∑–¥—É > –¥–∞—Ç–∞ –∑–∞—ó–∑–¥—É
- ‚úÖ –î–∞—Ç–∞ –∑–∞—ó–∑–¥—É –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É
- ‚úÖ –§–æ—Ä–º–∞—Ç –¥–∞—Ç –≤–∞–ª—ñ–¥–Ω–∏–π (ISO)
- ‚úÖ –î–∞—Ç–∏ —ñ—Å–Ω—É—é—Ç—å (–Ω–µ 32 –ª—é—Ç–æ–≥–æ)

**–ö–æ–¥:**

```typescript
if (toDate <= fromDate) {
  return NextResponse.json(
    { error: "–î–∞—Ç–∞ –≤–∏—ó–∑–¥—É –º–∞—î –±—É—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ –¥–∞—Ç–∏ –∑–∞—ó–∑–¥—É" },
    { status: 400 }
  );
}

if (!isFuture(fromDate)) {
  return NextResponse.json(
    { error: "–î–∞—Ç–∞ –∑–∞—ó–∑–¥—É –º–∞—î –±—É—Ç–∏ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É" },
    { status: 400 }
  );
}
```

---

### 7Ô∏è‚É£ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏ (GROQ Injection Protection)

**–©–æ –∑–∞—Ö–∏—â–∞—î:** Injection –∞—Ç–∞–∫–∏ –Ω–∞ Sanity

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∑–∞–º—ñ—Å—Ç—å –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—ó —Ä—è–¥–∫—ñ–≤
- Sanity –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –µ–∫—Ä–∞–Ω—É—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- –ù–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π GROQ –∫–æ–¥

**–ë–µ–∑–ø–µ—á–Ω–æ:**

```typescript
await sanityClient.fetch(
  `*[_type=="room" && _id==$id][0]`,
  { id: roomId } // –ü–∞—Ä–∞–º–µ—Ç—Ä –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ
);
```

**–ù–µ–±–µ–∑–ø–µ—á–Ω–æ (–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è):**

```typescript
// ‚ùå –ù–ï –†–û–ë–ò–¢–ò –¢–ê–ö:
await sanityClient.fetch(
  `*[_type=="room" && _id=="${roomId}"][0]` // –í—Ä–∞–∑–ª–∏–≤–æ –¥–æ injection
);
```

---

### 8Ô∏è‚É£ Data Sanitization –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –®–∫—ñ–¥–ª–∏–≤—ñ –¥–∞–Ω—ñ –≤ –ë–î, XSS –ø—Ä–∏ –≤–∏–≤–µ–¥–µ–Ω–Ω—ñ

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –°–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—è –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å–æ–º –≤ Sanity
- –ü–æ–¥–≤—ñ–π–Ω–∏–π –∑–∞—Ö–∏—Å—Ç: –ø—Ä–∏ –≤–≤–æ–¥—ñ —Ç–∞ –≤–∏–≤–æ–¥—ñ
- –ß–∏—Å—Ç—ñ –¥–∞–Ω—ñ –≤ –±–∞–∑—ñ

---

### 9Ô∏è‚É£ –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –†–æ–∑–∫—Ä–∏—Ç—Ç—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Å–∏—Å—Ç–µ–º–∏, –≤–∏—Ç—ñ–∫ —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –í development: –ø–æ–≤–Ω—ñ –¥–µ—Ç–∞–ª—ñ –ø–æ–º–∏–ª–æ–∫
- –í production: –∑–∞–≥–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- Stack trace —Ç—ñ–ª—å–∫–∏ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

**–ö–æ–¥:**

```typescript
return NextResponse.json(
  {
    error: "–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞",
    ...(process.env.NODE_ENV === "development" && {
      details: e.message,
      stack: e.stack,
    }),
  },
  { status: 500 }
);
```

---

### üîü CORS (Cross-Origin Resource Sharing)

**–©–æ –∑–∞—Ö–∏—â–∞—î:** –ù–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø –∑ —ñ–Ω—à–∏—Ö –¥–æ–º–µ–Ω—ñ–≤

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**

- –û–±–º–µ–∂–µ–Ω–Ω—è –¥–æ–º–µ–Ω—ñ–≤ —è–∫—ñ –º–æ–∂—É—Ç—å —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏
- –î–æ–∑–≤–æ–ª–µ–Ω—ñ –º–µ—Ç–æ–¥–∏: POST, OPTIONS
- –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—É `NEXT_PUBLIC_APP_URL`

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä—ñ–≤–Ω—ñ –∑–∞—Ö–∏—Å—Ç—É

### üîê HTTPS/TLS

- –í—Å—ñ –¥–∞–Ω—ñ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ man-in-the-middle –∞—Ç–∞–∫
- –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç SSL/TLS

### üîë Sanity —Ç–æ–∫–µ–Ω (Bearer Auth)

- API —Ç–æ–∫–µ–Ω –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –¢–æ–∫–µ–Ω –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ (–Ω–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É)
- –ó–º—ñ–Ω–Ω–∞ `SANITY_API_DEVELOPER_TOKEN` –≤ `.env.local`
- –ú–æ–∂–Ω–∞ –≤—ñ–¥–∫–ª–∏–∫–∞—Ç–∏ —Ç–∞ –ø–µ—Ä–µ–≤–∏–ø—É—Å—Ç–∏—Ç–∏ —Ç–æ–∫–µ–Ω

### üéØ Environment Variables

- –ß—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ (—Ç–æ–∫–µ–Ω–∏, –∫–ª—é—á—ñ) –≤ `.env.local`
- –ù–µ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –≤ Git (—á–µ—Ä–µ–∑ `.gitignore`)
- –û–∫—Ä–µ–º—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞ (`NEXT_PUBLIC_*`) —Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## –©–æ –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏

### 1. Redis –¥–ª—è Rate Limiting

–ó–∞–º—ñ—Å—Ç—å Map –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Redis –¥–ª—è distributed rate limiting:

```typescript
import Redis from "ioredis";
const redis = new Redis();

await redis.incr(`rate:${ip}`);
await redis.expire(`rate:${ip}`, 60);
```

### 2. JWT Authentication

–î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

```typescript
const token = jwt.sign({ userId }, SECRET_KEY);
```

### 3. CAPTCHA

–î–æ–¥–∞—Ç–∏ Google reCAPTCHA –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥–±–æ—Ç—ñ–≤

### 4. Webhook Signatures

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É webhook –≤—ñ–¥ Monobank:

```typescript
const signature = crypto
  .createHmac("sha256", WEBHOOK_SECRET)
  .update(body)
  .digest("hex");
```

### 5. CSP (Content Security Policy)

–î–æ–¥–∞—Ç–∏ HTTP headers:

```typescript
headers: {
  'Content-Security-Policy': "default-src 'self'",
}
```

---

## –í–∏—Å–Ω–æ–≤–æ–∫

**–ù–∞–≤—ñ—Ç—å –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Sanity (–∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É), –¥–æ–¥–∞—Ç–æ–∫ –º–∞—î 10 —Ä—ñ–≤–Ω—ñ–≤ –∑–∞—Ö–∏—Å—Ç—É:**

1. ‚úÖ Rate Limiting
2. ‚úÖ Input Validation (Zod)
3. ‚úÖ XSS Sanitization
4. ‚úÖ IP Tracking
5. ‚úÖ API Schema Validation
6. ‚úÖ Business Logic Validation
7. ‚úÖ Parameterized Queries
8. ‚úÖ Data Sanitization
9. ‚úÖ Error Hiding (Production)
10. ‚úÖ CORS

**–î–æ–¥–∞—Ç–∫–æ–≤–æ:**

- üîê HTTPS/TLS —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è
- üîë Bearer Token –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (Sanity)
- üéØ Environment Variables

–¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏—Ö –≤–µ–±-–≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π: SQL/NoSQL Injection, XSS, CSRF, DDoS, Rate Abuse.
